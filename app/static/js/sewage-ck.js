function commaSeparateNumber(e){while(/(\d+)(\d{3})/.test(e.toString()))e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}function type(e){e.amount=+e.amount;return e}var margin={top:50,right:20,bottom:50,left:80},width=575-margin.left-margin.right,height=500-margin.top-margin.bottom,x=d3.scale.ordinal().rangeRoundBands([0,width],.1),y=d3.scale.linear().range([height-1,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left").tickFormat(d3.format(",.0f")),chart=d3.select("#chart").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");d3.csv("static/data/sewage/sewage-overflow.csv",type,function(e,t){x.domain(t.map(function(e){return e.date}));y.domain([0,d3.max(t,function(e){return e.amount})]);chart.append("g").attr("class","x axis").attr("transform","translate(0,"+height+")").call(xAxis).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".10em").attr("transform",function(e){return"rotate(-65)"});chart.append("g").attr("class","y axis").call(yAxis).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").style("text-anchor","end").text("Volume (gallons)");chart.selectAll(".bar").data(t).enter().append("rect").attr("class","bar").attr("x",function(e){return x(e.date)}).attr("width",x.rangeBand()).attr("y",function(e){return y(e.amount)}).attr("height",function(e){return height-y(e.amount)});var n=chart.selectAll(".bar"),r=200,i=-5,s=chart.append("text").attr("x",r).attr("y",i).attr("class","water-body"),o=chart.append("text").attr("x",r).attr("y",i+10).attr("font-size","10px").attr("class","municipality"),u=chart.append("text").attr("display","none").attr("x",r).attr("y",i+25).attr("font-size","12px").attr("class","reason").text("Reason:"),a=chart.append("text").attr("x",r).attr("y",i+35).attr("font-size","10px").attr("class","type"),f=chart.append("text").attr("x",r).attr("y",i+45).attr("font-size","10px").attr("class","volume");n.on("mouseover",function(e){u.attr("display","block");s.text(e.water_body);o.text(e.municipality);a.text(e.type);var t;e.amount==999?t="< 1,000":t=commaSeparateNumber(e.amount);f.text("Total Volume Discharged: "+t+" gallons")})});chart.append("text").attr("class","more-info").attr("width","150px").attr("x",200).attr("y",-30).attr("height",100).attr("text-decoration","underline").text("Hover over an event for more details");